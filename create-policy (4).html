<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Create Policy Set</title>
  <link rel="stylesheet" href="./nav.css">
  <style>
    :root{
      --bg:#fff;
      --text:#111;
      --muted:#666;
      --line:#111;
      --line2:#bbb;
      --radius:14px;
      --navw:240px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:var(--sans); background:var(--bg); color:var(--text); min-height:100vh;}
    a{color:inherit}

    #leftNavMount{position:fixed; left:0; top:0; bottom:0; width:var(--navw); z-index:50;}

    /* Injected nav look (light / bordered) */
    #leftNavMount .nav{
      position:fixed; left:0; top:0; bottom:0; width:var(--navw);
      border-right:2px solid var(--line);
      padding:18px 14px;
      background:#fff;
      display:flex; flex-direction:column; gap:14px;
      overflow:auto;
    }
    #leftNavMount .brand{font-weight:900; letter-spacing:-0.02em}
    #leftNavMount .navSection{display:flex; flex-direction:column; gap:6px}
    #leftNavMount .navItem{
      display:flex; gap:10px; align-items:center;
      padding:8px 10px;
      border:2px solid transparent;
      border-radius:12px;
      cursor:pointer;
      text-decoration:none;
    }
    #leftNavMount .navItem:hover{border-color:var(--line2)}
    #leftNavMount .navItem.active{border-color:var(--line)}
    #leftNavMount .navBottom{margin-top:auto; padding-top:10px; border-top:2px solid var(--line2)}

    .content{margin-left:var(--navw); min-height:100vh;}
    .page{padding:16px; padding-bottom:92px;}
    .topbar{
      position:sticky; top:0; z-index:20;
      background:#fff; border-bottom:2px solid var(--line);
      padding:12px 16px;
    }
    .objTitle{font-weight:900; font-size:16px; letter-spacing:-0.02em}
    .objSub{font-size:12px; margin-top:2px; color:var(--muted)}

    .wizardGrid{display:grid; grid-template-columns: 340px 1fr; gap:14px; align-items:start;}
    .card{border:2px solid var(--line); border-radius:var(--radius); background:#fff;}
    .panel{border:2px solid var(--line); border-radius:var(--radius); padding:12px; background:#fff;}
    .muted{color:var(--muted)}
    .mono{font-family:var(--mono)}

    #stepper{padding:12px;}
    .step{
      display:flex; gap:10px; align-items:flex-start;
      padding:10px 10px;
      border-radius:12px;
      border:2px solid transparent;
      color:var(--muted);
      font-size:13px;
      cursor:pointer;
    }
    .step:hover{border-color:var(--line2); color:var(--text)}
    .step .dot{
      width:18px; height:18px;
      border:2px solid var(--line2);
      display:flex; align-items:center; justify-content:center;
      font-size:11px; color:var(--muted);
      flex:0 0 18px; margin-top:1px; font-weight:900;
    }
    .step.active{color:var(--text); border-color:var(--line);}
    .step.done .dot{border-color:var(--line); color:var(--text)}

    #stepContent{padding:14px;}
    #stepContent h2{margin:0 0 8px; font-size:18px; font-weight:900}
    #stepContent p{margin:0; color:var(--muted); font-size:13px; line-height:1.4}

    .btn{
      border:2px solid var(--line);
      background:#fff;
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      font-weight:900;
      font-size:13px;
    }
    .btn:hover{background:#f7f7f7}
    .btn.primary{background:#111; color:#fff}
    .btn.primary:hover{background:#000}
    .btn.quiet{background:#f7f7f7}

    input, select, textarea{font-family:inherit}

    .stickybar{
      position:fixed; left:var(--navw); right:0; bottom:0; z-index:10000;
      background:#fff; border-top:2px solid var(--line);
      padding:10px 16px;
      box-shadow:0 -8px 24px rgba(0,0,0,.12);
    }
    .stickybar.hidden{display:none}
    .stickyInner{display:flex; justify-content:flex-end; gap:10px; align-items:center}

    #drawerOverlay{
      position:fixed; inset:0; background:rgba(0,0,0,.15);
      display:none; z-index:9000;
      align-items:stretch;
    }
    #drawer{
      margin-left:auto;
      width:440px; max-width:92vw;
      background:#fff; border-left:2px solid var(--line);
      display:flex; flex-direction:column;
      height:100%;
    }
    #drawerHeader{
      border-bottom:2px solid var(--line);
      padding:12px;
      display:flex; justify-content:space-between; align-items:flex-start; gap:10px;
    }
    #drawerContent{padding:12px; overflow:auto; flex:1}

    #toast{
      position:fixed; left:calc(var(--navw) + 16px); bottom:92px;
      padding:10px 12px; border:2px solid var(--line); border-radius:12px; background:#fff;
      display:none; z-index:12000; font-weight:900; box-shadow:0 10px 22px rgba(0,0,0,.12);
    }

    @media (max-width: 980px){
      .wizardGrid{grid-template-columns: 1fr;}
      #leftNavMount{position:static; width:auto;}
      .content{margin-left:0;}
      .stickybar{left:0;}
    }
  </style>
</head>

<body data-nav="policy-sets">
  <div id="leftNavMount"></div>

  <div class="content">
    <div class="topbar">
      <div>
        <div class="objTitle">Create Policy Set</div>
        <div class="objSub">Wizard prototype</div>
      </div>
    </div>

    <main class="page">
      <section id="wizard" class="screen">
        <div class="wizardGrid">
          <aside class="card" id="stepper"></aside>
          <section class="card" aria-label="Wizard step content">
            <div id="stepContent"><div class="muted">Loading…</div></div>
          </section>
        </div>
      </section>
    </main>
  </div>

  <div id="sticky" class="stickybar hidden">
    <div class="stickyInner">
      <button class="btn quiet" id="backBtn" onclick="back()">Back</button>
      <button class="btn quiet hidden" id="secondaryBtn" onclick="secondaryAction()"> </button>
      <button class="btn primary" id="nextBtn" onclick="next()">Next</button>
      <span id="hint" style="display:none"></span>
    </div>
  </div>

  <div id="drawerOverlay" onclick="closeDrawer(event)">
    <aside id="drawer" aria-label="Drawer">
      <div id="drawerHeader">
        <div style="font-weight:900">Details</div>
        <button class="btn quiet" onclick="hideDrawer(); event.stopPropagation();">Close</button>
      </div>
      <div id="drawerContent"></div>
    </aside>
  </div>

  <div id="toast"></div>

  <script>
  (async function loadNav(){
    const mount = document.getElementById('leftNavMount');
    if(!mount) return;
    try{
      const res = await fetch('./nav.html', {cache:'no-store'});
      mount.innerHTML = await res.text();
      const activeKey = document.body.getAttribute('data-nav');
      if(activeKey){
        mount.querySelectorAll('.navItem').forEach(a=>a.classList.toggle('active', a.dataset.nav===activeKey));
      }
    } catch(e) {
      console.warn('Could not load nav.html', e);
    }
  })();
  </script>

  <script>
const steps = [
    { id:"method", title:"Method" },
    { id:"document", title:"Document" },
    { id:"analyze", title:"Analyze" },
    { id:"scope", title:"Regulatory scope" },
    { id:"regTasks", title:"Regulatory tasks" },
    { id:"orgTasks", title:"Organizational tasks" },
    { id:"summary", title:"Summary" },
  ];

  let state = {
    screen: "wizard",
    stepIndex: 0,
    method: "ai",
    fileName: "Carrier A contract.pdf",
    scopeRows: [
      {on:true, st:"CA", prod:"Life", licName:"Life Agent", licCode:"CA-LIFE", loaName:"Life", loaCode:"L"},
      {on:true, st:"CA", prod:"Annuity", licName:"Life Agent", licCode:"CA-LIFE", loaName:"Variable Annuity", loaCode:"VA"},
      {on:true, st:"TX", prod:"Life", licName:"General Lines Life, Accident, Health", licCode:"TX-GL", loaName:"Life", loaCode:"L"},
      {on:true, st:"FL", prod:"Annuity", licName:"Life", licCode:"FL-L", loaName:"Annuities", loaCode:"A"},
      {on:true, st:"AZ", prod:"Life", licName:"Life", licCode:"AZ-L", loaName:"Life", loaCode:"L"},
      {on:true, st:"CO", prod:"Life", licName:"Life", licCode:"CO-L", loaName:"Life", loaCode:"L"},
    ],
    regTasks: [
      { name:"Verify active resident license", type:"Approval", desc:"Confirm producer holds an active, eligible resident license for the Policy Set scope.", who:"Operations Manager", approver:"Compliance (optional)" },
      { name:"Confirm LOA eligibility", type:"Attest", desc:"Producer attests they are authorized for relevant lines of authority.", who:"Producer", approver:"Operations Manager" },
      { name:"Background check requirement", type:"Upload", desc:"Collect evidence or confirmation that screening requirements are met (if applicable).", who:"Producer", approver:"Operations Manager" },
      { name:"State-specific appointment filing", type:"Data", desc:"Ensure appointment filing workflow triggers for in-scope states where required.", who:"System", approver:"Operations Manager" },
    ],
    orgTasks: [
      { name:"Carrier training: Product overview", type:"Read/Ack", desc:"Producer reviews carrier-required product overview training content.", who:"Producer", approver:"None" },
      { name:"W-9 / tax form on file", type:"Upload", desc:"Collect required tax documentation as part of carrier contracting.", who:"Producer", approver:"Operations Manager" },
      { name:"E&O insurance verification", type:"Upload", desc:"Confirm producer has required Errors & Omissions coverage.", who:"Producer", approver:"Operations Manager" },
    ],
    selectedRegTask: 0,
    selectedOrgTask: 0,
  };

  function $(id){ return document.getElementById(id); }

  function go(screen){
    state.screen = screen;
    document.querySelectorAll(".screen").forEach(s => s.classList.add("hidden"));
    $(screen).classList.remove("hidden");
    if(screen === "wizard"){
      renderStepper();
      renderStep();
      $("sticky").classList.remove("hidden");
    } else {
      $("sticky").classList.add("hidden");
    }
    hideDrawer();
  }

  function startPolicySet(){
    state.stepIndex = 0;
    go("wizard");
  }

  function renderStepper(){
    const el = $("stepper");
    el.innerHTML = "";
    steps.forEach((s, i) => {
      const stepEl = document.createElement("div");
      stepEl.className = "step" + (i === state.stepIndex ? " active" : "") + (i < state.stepIndex ? " done" : "");
      stepEl.onclick = () => jump(i);
      stepEl.innerHTML = `
        <div class="dot">${i < state.stepIndex ? "✓" : (i+1)}</div>
        <div style="font-weight:900">${s.title}</div>`;
      el.appendChild(stepEl);
    });
  }

  function jump(i){
    if(i <= state.stepIndex){
      state.stepIndex = i;
      renderStepper();
      renderStep();
    } else {
      toast("Complete the step using the primary CTA.");
    }
  }

  function back(){
    if(state.stepIndex === 0){ go("hub"); return; }
    state.stepIndex -= 1;
    renderStepper();
    renderStep();
  }

  function next(){
    const id = steps[state.stepIndex].id;
    if(id === "analyze"){ return; }
    if(state.stepIndex < steps.length - 1){
      state.stepIndex += 1;
      renderStepper();
      renderStep();
    }
  }

  function secondaryAction(){
    const id = steps[state.stepIndex].id;
    if(id === "document"){
      toast("In the full product this would switch to manual scope entry.");
    } else if(id === "scope"){
      toast("CSV exported (prototype).");
    } else if(id === "summary"){
      toast("This would open the Policy Sets list view.");
    }
  }

  function setSticky({nextLabel="Next", secondaryLabel="", hint=""}){
    const n = $("nextBtn"); if(n) n.textContent = nextLabel;
    // no pills/hints in this rebuild
    const h = $("hint"); if(h) h.textContent = "";
    const s = $("secondaryBtn");
    if(!secondaryLabel){
      s.classList.add("hidden");
    } else {
      s.classList.remove("hidden");
      s.textContent = secondaryLabel;
    }
  }

  function renderStep(){
    const id = steps[state.stepIndex].id;
    const c = $("stepContent");

    $("backBtn").textContent = (state.stepIndex === 0) ? "Back to personas" : "Back";
    $("nextBtn").onclick = next;

    if(id === "method"){
      c.innerHTML = `
        <h2>How do you want to create this Policy Set?</h2>
        <p>Choose a method. You can review everything before confirming.</p>

        <div class="section grid2">
          <div class="radio-card ${state.method==="ai" ? "selected":""}" onclick="chooseMethod('ai')">
            <div class="radio"><div class="inner"></div></div>
            <div>
              <h3>Use AI (recommended)</h3>
              <p>Upload a carrier contract or program guide. We’ll draft scope + tasks for review.</p>
            </div>
          </div>
          <div class="radio-card ${state.method==="manual" ? "selected":""}" onclick="chooseMethod('manual')">
            <div class="radio"><div class="inner"></div></div>
            <div>
              <h3>Manual</h3>
              <p>Build scope + requirements from scratch.</p>
            </div>
          </div>
        </div>
      `;
      setSticky({nextLabel:"Continue", hint:"One primary choice"});
    }

    if(id === "document"){
      c.innerHTML = `
        <h2>Upload source document</h2>
        <p>Drop a file to generate an initial Policy Set draft.</p>

        <div class="section grid2">
          <div class="panel">
            <div class="dropzone">
              <div class="filetile">
                <div class="fileicon">PDF</div>
                <div class="filemeta">
                  <div class="name">${escapeHtml(state.fileName)}</div>
                  <div class="hint">Already added • Replace or remove</div>
                </div>
              </div>
              <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end">
                <button class="quiet" onclick="toast('Replace file (prototype)')">Replace</button>
                <button class="quiet" onclick="toast('Remove file (prototype)')">Remove</button>
              </div>
            </div>
            <div class="subtitle" style="margin-top:10px">Supported: PDF, DOCX (max 25MB)</div>
          </div>

          <div class="panel">
            <div style="font-weight:900; margin-bottom:8px">What we’ll extract</div>
            <div class="tags">
              <span class="tag">States</span>
              <span class="tag">Products</span>
              <span class="tag">Licenses / LOAs</span>
              <span class="tag">Carrier requirements</span>
            </div>
            <div class="divider"></div>
            <button class="linkbtn" onclick="toast('Would switch to manual entry')">Skip and enter scope manually</button>
          </div>
        </div>
      `;
      setSticky({nextLabel:"Next: Analyze", secondaryLabel:"Skip (manual)", hint:"Upload → analyze → review"});
    }

    if(id === "analyze"){
      c.innerHTML = `
        <h2>Analyzing your document</h2>
        <p>We’re extracting regulatory scope and drafting tasks.</p>

        <div class="section panel">
          <div style="display:flex; flex-direction:column; gap:10px; font-weight:900">
            <div>1) Extracting regulatory scope…</div>
            <div>2) Detecting product types…</div>
            <div>3) Drafting tasks…</div>
          </div>
          <div class="divider"></div>
          <div class="subtitle">You’ll be able to review everything before confirming.</div>
        </div>
      `;
      setSticky({nextLabel:"Working…", hint:"Auto-advances"});
      setTimeout(() => {
        if(steps[state.stepIndex].id === "analyze"){
          state.stepIndex += 1;
          renderStepper();
          renderStep();
        }
      }, 700);
    }

    if(id === "scope"){
      const states = ["CA","TX","FL","AZ","CO","NV"];
      const products = ["Life","Annuity"];
      c.innerHTML = `
        <h2>Confirm regulatory scope</h2>
        <p>Review what we extracted. Unchecked rows won’t be included in this Policy Set.</p>

        <div class="section banner">
          <div>
            <div class="line">We found regulatory scope for ${states.length} states <span>(${states.join(", ")})</span></div>
            <div class="line">Products allowed <span>(${products.join(", ")})</span></div>
          </div>
          <div>
            <button class="quiet" onclick="toast('Expanded lists (prototype)')">Expand</button>
          </div>
        </div>

        <div class="toolbar">
          <input class="input" placeholder="Search to add scope…" oninput="toast('Add row search (prototype)')" />
          <div style="display:flex; gap:10px; flex-wrap:wrap">
            <button class="quiet" onclick="selectAll(true)">Select all</button>
            <button class="quiet" onclick="selectAll(false)">Select none</button>
          </div>
        </div>

        <div class="tablewrap">
          <table>
            <thead>
              <tr>
                <th style="width:42px"><input type="checkbox" class="check" onclick="toggleHeader(this)" /></th>
                <th>State</th><th>Product Type</th><th>License Name</th><th>License Code</th><th>LOA Name</th><th>LOA Code</th>
              </tr>
            </thead>
            <tbody>
              ${state.scopeRows.map((r, idx) => `
                <tr>
                  <td><input type="checkbox" class="check" ${r.on ? "checked":""} onchange="toggleRow(${idx}, this.checked)" /></td>
                  <td>${r.st}</td><td>${r.prod}</td><td>${escapeHtml(r.licName)}</td><td>${r.licCode}</td><td>${escapeHtml(r.loaName)}</td><td>${r.loaCode}</td>
                </tr>
              `).join("")}
            </tbody>
          </table>
        </div>
      `;
      setSticky({nextLabel:"Confirm regulatory scope", secondaryLabel:"Download CSV", hint:"Prune + add rows"});
    }

    if(id === "regTasks"){
      c.innerHTML = `
        <h2>Regulatory requirements</h2>
        <p>Scan the list. Open details only when you need to modify something.</p>

        <div class="listonly">
          <div class="list">
            <div class="listhead">
              <div class="title2">Tasks</div>
              <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap">
                <input class="input" style="width:260px" placeholder="Search tasks…" oninput="toast('Task search (prototype)')" />
                <button class="quiet" onclick="addTask('reg')">+ New task</button>
              </div>
            </div>

            ${state.regTasks.map((t, i) => `
              <div class="item ${i===state.selectedRegTask ? "active":""}" onclick="openTask('reg', ${i})">
                <div class="leftmeta">
                  <div class="row1">
                    <div class="name">${escapeHtml(t.name)}</div>
                    <span class="badge">${t.type}</span>
                  </div>
                  <div class="hintline">Click to view details</div>
                </div>
                <div class="rightmeta">
                  <button class="secondaryAction" onclick="event.stopPropagation(); toast('Quick edit (prototype)')">Edit</button>
                  <span class="chev">&gt;</span>
                </div>
              </div>
            `).join("")}
          </div>
        </div>
      `;
      setSticky({nextLabel:"Confirm regulatory tasks", hint:"List-first scanning"});
    }

    if(id === "orgTasks"){
      c.innerHTML = `
        <h2>Organizational requirements</h2>
        <p>Scan carrier/agency requirements. Open details only when necessary.</p>

        <div class="listonly">
          <div class="list">
            <div class="listhead">
              <div class="title2">Tasks</div>
              <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap">
                <input class="input" style="width:260px" placeholder="Search tasks…" oninput="toast('Task search (prototype)')" />
                <button class="quiet" onclick="addTask('org')">+ New task</button>
              </div>
            </div>

            ${state.orgTasks.map((t, i) => `
              <div class="item ${i===state.selectedOrgTask ? "active":""}" onclick="openTask('org', ${i})">
                <div class="leftmeta">
                  <div class="row1">
                    <div class="name">${escapeHtml(t.name)}</div>
                    <span class="badge">${t.type}</span>
                  </div>
                  <div class="hintline">Click to view details</div>
                </div>
                <div class="rightmeta">
                  <button class="secondaryAction" onclick="event.stopPropagation(); toast('Quick edit (prototype)')">Edit</button>
                  <span class="chev">&gt;</span>
                </div>
              </div>
            `).join("")}
          </div>
        </div>
      `;
      setSticky({nextLabel:"Confirm organizational tasks", hint:"List-first scanning"});
    }

    if(id === "summary"){
      c.innerHTML = `
        <h2>Policy Set created</h2>
        <p>Review what this Policy Set contains. You can modify any section.</p>

        <div class="section panel">
          <div style="display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap">
            <div style="display:flex; flex-direction:column; gap:6px">
              <div style="font-weight:900">Policy Set name</div>
              <div class="subtitle" style="margin:0">Carrier A – Life/Annuity – Southwest</div>
            </div>
            <button class="quiet" onclick="toast('Rename (prototype)')">Rename</button>
          </div>
        </div>

        <div class="cards1">
          <div class="card summarycard">
            <h3>Regulatory scope</h3>
            <p><strong>74 regulatory codes</strong> across <strong>6 states</strong> allowing producers to sell <strong>2 product types</strong>.</p>
            <div class="divider"></div>
            <button class="linkbtn" onclick="jumpTo('scope')">Review / Modify</button>
          </div>
          <div class="card summarycard">
            <h3>Regulatory requirements</h3>
            <p>All regulatory tasks within the scope of your policy set.</p>
            <div class="divider"></div>
            <button class="linkbtn" onclick="jumpTo('regTasks')">Review / Modify</button>
          </div>
          <div class="card summarycard">
            <h3>Organizational requirements</h3>
            <p>Non-regulatory requirements to satisfy appointing and ready-to-sell.</p>
            <div class="divider"></div>
            <button class="linkbtn" onclick="jumpTo('orgTasks')">Review / Modify</button>
          </div>
        </div>

        <div class="section panel">
          <div style="display:flex; gap:10px; flex-wrap:wrap">
            <button class="primary" onclick="toast('Would navigate to firm mapping flow')">Map to a firm</button>
            <button class="quiet" onclick="toast('Would open Policy Sets list view')">View all Policy Sets</button>
            <button class="quiet" onclick="startPolicySet()">Create another Policy Set</button>
          </div>
        </div>
      `;
      setSticky({nextLabel:"Back to personas", secondaryLabel:"Policy Sets list", hint:"Create → map → operate"});
      $("nextBtn").onclick = () => go("hub");
      return;
    }
  }

  function chooseMethod(m){
    state.method = m;
    renderStep();
  }

  function toggleRow(idx, checked){
    state.scopeRows[idx].on = checked;
  }

  function toggleHeader(cb){
    const checked = cb.checked;
    state.scopeRows.forEach(r => r.on = checked);
    renderStep();
  }

  function selectAll(on){
    state.scopeRows.forEach(r => r.on = on);
    renderStep();
  }

  function addTask(kind){
    toast("Add task (prototype) — would open drawer");
  }

  function openTask(kind, idx){
    if(kind === "reg") state.selectedRegTask = idx;
    else state.selectedOrgTask = idx;
    showDrawer(kind);
    // keep list visible / primary focus; drawer is secondary
    renderStep();
  }

  function showDrawer(kind){
    const t = (kind === "reg") ? state.regTasks[state.selectedRegTask] : state.orgTasks[state.selectedOrgTask];
    $("drawerContent").innerHTML = renderTaskDetail(t);
    $("drawerOverlay").style.display = "flex";
  }

  function hideDrawer(){
    $("drawerOverlay").style.display = "none";
  }

  function closeDrawer(e){
    // click outside drawer closes
    hideDrawer();
  }

  function renderTaskDetail(t){
    return `
      <h3>${escapeHtml(t.name)}</h3>
      <p style="margin:0; color:#555; font-weight:700; line-height:1.35">${escapeHtml(t.desc)}</p>
      <div class="kv">
        <div class="k">Task type</div><div class="v">${escapeHtml(t.type)}</div>
        <div class="k">Completed by</div><div class="v">${escapeHtml(t.who)}</div>
        <div class="k">Approver</div><div class="v">${escapeHtml(t.approver)}</div>
      </div>
      <div class="divider"></div>
      <div style="display:flex; gap:10px; flex-wrap:wrap">
        <button class="primary" onclick="toast('Edit task (prototype)')">Edit task</button>
        <button class="quiet" onclick="toast('Delete task (prototype)')">Delete</button>
      </div>
    `;
  }

  function jumpTo(stepId){
    const idx = steps.findIndex(s => s.id === stepId);
    if(idx >= 0){
      state.stepIndex = idx;
      renderStepper();
      renderStep();
      window.scrollTo({top:0, behavior:"smooth"});
    }
  }

  function toast(msg){
    const el = $("toast");
    el.textContent = msg;
    el.classList.remove("hidden");
    clearTimeout(window.__toastTimer);
    window.__toastTimer = setTimeout(() => el.classList.add("hidden"), 1400);
  }

  function escapeHtml(str){
    return String(str)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  // init
  go("hub");

  // Auto-start wizard on load (this file is the wizard entry point)
  document.addEventListener("DOMContentLoaded", ()=>{
    try{
      if(state.screen !== "wizard"){ state.screen = "wizard"; }
      go("wizard");
    }catch(e){
      console.error(e);
      const c = document.getElementById("stepContent");
      if(c) c.innerHTML = `<div class="panel" style="border-color:#b91c1c"><div style="font-weight:900">Error starting wizard</div><div class="muted" style="margin-top:6px">${String(e)}</div></div>`;
    }
  });

  </script>
</body>
</html>

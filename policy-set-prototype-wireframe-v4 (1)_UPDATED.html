<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Policy Set Wizard Prototype (Wireframe)</title>
  <style>
    :root{
      --bg:#ffffff;
      --text:#111111;
      --muted:#555555;
      --line:#111111;
      --line2:#bdbdbd;
      --panel:#ffffff;
      --shadow:none;
      --radius:10px;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:var(--sans); background:var(--bg); color:var(--text)}
    a{color:inherit}
    .topbar{
      position:sticky; top:0; z-index:20;
      background: #fff;
      border-bottom:2px solid var(--line);
    }
    .topbar-inner{
      max-width:1100px; margin:0 auto;
      display:flex; align-items:center; justify-content:space-between;
      padding:12px 16px;
    }
    .brand{display:flex; gap:10px; align-items:center; font-weight:800; cursor:pointer}
    .logo{
      width:18px; height:18px;
      border:2px solid var(--line);
      background:#fff;
    }
    .pill{
      border:2px solid var(--line);
      background:#fff;
      color:var(--text);
      border-radius:10px;
      padding:6px 10px;
      font-size:12px;
      font-weight:700;
    }
    .container{max-width:1100px; margin:0 auto; padding:18px 16px 90px;}
    .title{font-size:26px; font-weight:900; letter-spacing:-.2px; margin:0}
    .subtitle{margin:8px 0 0; color:var(--muted); line-height:1.35}
    .section{margin-top:14px}

    /* Cards as single-column list */
    .card{
      background: var(--panel);
      border:2px solid var(--line);
      border-radius:var(--radius);
      box-shadow: var(--shadow);
    }
    .stack{display:flex; flex-direction:column; gap:12px}
    .persona-card{padding:14px}
    .persona-card h3{margin:0 0 6px; font-size:15px}
    .persona-card p{margin:0 0 10px; color:var(--muted); font-size:13px; line-height:1.35}

    /* Tag list for use cases */
    .tags{display:flex; flex-wrap:wrap; gap:8px; margin:10px 0 12px}
    .tag{
      border:2px solid var(--line);
      border-radius:10px;
      padding:4px 10px;
      font-size:12px;
      font-weight:800;
      background:#fff;
    }
    .tag.muted{border-color:var(--line2); color:var(--muted); font-weight:700}

    button{
      font-family:inherit;
      border:2px solid var(--line);
      background:#fff;
      color:var(--text);
      padding:9px 12px;
      border-radius:10px;
      cursor:pointer;
      font-weight:900;
      font-size:13px;
    }
    button:hover{background:#f5f5f5}
    .primary{background:#111; color:#fff}
    .primary:hover{background:#000}
    .quiet{
      background:#fff;
      border-color:var(--line2);
      color:var(--muted);
      font-weight:800;
    }
    .linkbtn{
      background:transparent; border:none; padding:0; text-decoration:underline;
      font-weight:900; cursor:pointer; font-size:13px;
    }

    .wizard{
      display:grid; grid-template-columns: 260px 1fr; gap:12px;
      align-items:start;
    }
    .sidebar{padding:12px}
    .sidebar .small{color:var(--muted); font-size:12px; margin:0 0 10px}
    .step{
      display:flex; gap:10px; align-items:flex-start;
      padding:8px 8px;
      border-radius:10px;
      border:2px solid transparent;
      color:var(--muted);
      font-size:13px;
      cursor:pointer;
    }
    .step:hover{border-color: var(--line2); color:var(--text)}
    .step .dot{
      width:18px; height:18px;
      border:2px solid var(--line2);
      display:flex; align-items:center; justify-content:center;
      font-size:11px; color:var(--muted);
      flex:0 0 18px;
      margin-top:1px;
      font-weight:900;
    }
    .step.active{
      color:var(--text);
      border-color: var(--line);
      background:#fff;
    }
    .step.done .dot{
      border-color: var(--line);
      color: var(--text);
    }

    .content{padding:14px}
    .content h2{margin:0 0 8px; font-size:18px; font-weight:900}
    .content p{margin:0; color:var(--muted); font-size:13px; line-height:1.4}

    .stickybar{
      position:fixed; left:0; right:0; bottom:0; z-index:30;
      background:#fff;
      border-top:2px solid var(--line);
    }
    .stickybar-inner{
      max-width:1100px; margin:0 auto;
      padding:10px 16px;
      display:flex; justify-content:space-between; align-items:center; gap:12px;
    }
    .kbd{
      font-family:var(--mono);
      font-size:11px;
      color:var(--muted);
      border:2px solid var(--line2);
      padding:3px 8px;
      border-radius:999px;
      background:#fff
    }
    .panel{
      padding:12px;
      border-radius:var(--radius);
      border:2px solid var(--line2);
      background:#fff
    }

    .grid2{display:grid; grid-template-columns:repeat(2,1fr); gap:12px}
    .radio-card{
      padding:12px;
      border-radius:var(--radius);
      border:2px solid var(--line);
      background:#fff;
      cursor:pointer;
      display:flex; gap:12px; align-items:flex-start;
    }
    .radio{
      width:18px; height:18px; border-radius:10px;
      border:2px solid var(--line);
      margin-top:2px;
      display:flex; align-items:center; justify-content:center;
      flex:0 0 18px;
    }
    .radio .inner{
      width:10px; height:10px; border-radius:10px;
      background: transparent;
    }
    .radio-card.selected{background:#f5f5f5}
    .radio-card.selected .radio .inner{background:#111}
    .radio-card h3{margin:0 0 6px; font-size:14px; font-weight:900}
    .radio-card p{margin:0; color:var(--muted); font-size:12.5px; line-height:1.35}

    .dropzone{
      border:2px dashed var(--line);
      border-radius:var(--radius);
      padding:12px;
      background:#fff;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    .filetile{
      display:flex; gap:10px; align-items:center;
      padding:10px 12px;
      border-radius:var(--radius);
      border:2px solid var(--line);
      background:#fff;
      min-width: 320px;
    }
    .fileicon{
      width:34px; height:34px; border-radius:8px;
      border:2px solid var(--line);
      display:flex; align-items:center; justify-content:center;
      font-weight:900;
      font-family:var(--mono);
    }
    .filemeta{display:flex; flex-direction:column; gap:2px}
    .filemeta .name{font-weight:900; font-size:13px}
    .filemeta .hint{font-size:12px; color:var(--muted)}
    .divider{height:2px; background:var(--line2); margin:12px 0}

    .banner{
      border:2px solid var(--line);
      background:#fff;
      border-radius:var(--radius);
      padding:10px 12px;
      display:flex; justify-content:space-between; gap:12px; align-items:flex-start;
    }
    .banner .line{font-size:13px; color:var(--text); font-weight:900; margin:0 0 6px}
    .banner .line span{color:var(--muted); font-weight:800}

    .toolbar{display:flex; justify-content:space-between; align-items:center; gap:10px; margin-top:12px; flex-wrap:wrap}
    .input{
      border:2px solid var(--line);
      background:#fff;
      color:var(--text);
      border-radius:10px;
      padding:9px 12px;
      font-size:13px;
      width: 340px;
      outline:none;
      font-weight:700;
    }

    .tablewrap{margin-top:12px; border:2px solid var(--line); border-radius:var(--radius); overflow:hidden}
    table{width:100%; border-collapse:collapse; font-size:13px}
    thead{background:#f5f5f5; color:var(--text); font-weight:900}
    th, td{padding:10px 10px; border-bottom:2px solid var(--line2); text-align:left}
    tbody tr:hover{background:#fafafa}
    .check{width:18px; height:18px}

    /* Tasks: list-first. Detail is collapsed drawer. */
    .listonly{margin-top:12px}
    .list{
      border:2px solid var(--line);
      border-radius:var(--radius);
      overflow:hidden;
      background:#fff;
    }
    .listhead{
      padding:10px 12px;
      border-bottom:2px solid var(--line2);
      display:flex; justify-content:space-between; align-items:center; gap:10px;
    }
    .listhead .title2{font-weight:900; font-size:13px}
    .item{
      padding:10px 12px;
      border-bottom:2px solid var(--line2);
      cursor:pointer;
      display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
    }
    .item:last-child{border-bottom:none}
    .leftmeta{display:flex; flex-direction:column; gap:6px}
    .row1{display:flex; align-items:center; gap:10px; flex-wrap:wrap}
    .name{font-weight:900; font-size:13px}
    .badge{
      font-size:11px;
      padding:3px 8px;
      border-radius:10px;
      border:2px solid var(--line);
      color:var(--text);
      background:#fff;
      font-weight:900;
    }
    .hintline{font-size:12px; color:var(--muted); font-weight:700}
    .item.active{background:#f5f5f5}
    .rightmeta{display:flex; align-items:center; gap:10px}
    .chev{font-family:var(--mono); font-weight:900; color:var(--muted)}
    .secondaryAction{border-color:var(--line2); color:var(--muted); font-weight:900}

    /* Drawer */
    .drawerOverlay{
      position:fixed; inset:0; background:rgba(0,0,0,.25);
      display:none; z-index:60;
      align-items:stretch; justify-content:flex-end;
    }
    .drawer{
      width:min(520px, 92vw);
      background:#fff;
      border-left:2px solid var(--line);
      padding:14px;
      overflow:auto;
    }
    .drawer h3{margin:0 0 8px; font-size:16px; font-weight:900}
    .kv{display:grid; grid-template-columns: 140px 1fr; gap:8px; font-size:13px; margin-top:10px}
    .k{color:var(--muted); font-weight:800}
    .v{color:var(--text); font-weight:800}

    /* Summary cards as single-column list */
    .cards1{display:flex; flex-direction:column; gap:12px; margin-top:12px}
    .summarycard{padding:12px}
    .summarycard h3{margin:0 0 6px; font-size:14px; font-weight:900}
    .summarycard p{margin:0; color:var(--muted); font-size:13px; line-height:1.35}

    
    .grid3{display:grid; grid-template-columns:repeat(3,1fr); gap:12px}
    .usecases{margin:10px 0 12px; padding-left:18px}
    .usecases li{margin:6px 0; color:var(--muted); font-weight:800; font-size:13px}
    .usecases a{color:var(--text); text-decoration:underline; font-weight:900}
    .usecases a.muted{color:var(--muted); text-decoration:none; font-weight:800}
    .usecases a:hover{text-decoration:underline}
    @media (max-width: 980px){
      .grid3{grid-template-columns:1fr}
    }

    .hidden{display:none !important}
    @media (max-width: 980px){
      .wizard{grid-template-columns: 1fr}
      .grid2{grid-template-columns:1fr}
      .input{width:100%}
      .filetile{min-width: 0; width:100%}
    }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand" onclick="goHome()">
        <div class="logo"></div>
        <div>Wireframe Prototype</div>
        <span class="kbd">Home</span>
      </div>
      <div style="display:flex; gap:10px; align-items:center">
        <div class="pill">Help</div>
        <div class="pill">David</div>
      </div>
    </div>
  </div>

  <div class="container">

<!-- WIZARD -->
    <section id="wizard" class="screen hidden">
      <div class="wizard">
        <aside class="card sidebar">
          <p class="small">Create Policy Set</p>
          <div id="stepper"></div>
          <div class="divider"></div>
          <button class="quiet" onclick="goHome()" style="width:100%">Back to personas</button>
        </aside>

        <main class="card content">
          <div id="stepContent"></div>
        </main>
      </div>
    </section>
  </div>

  <!-- Sticky nav -->
  <div id="sticky" class="stickybar hidden">
    <div class="stickybar-inner">
      <div style="display:flex; gap:10px; align-items:center">
        <button class="quiet" id="backBtn" onclick="back()">Back</button>
        <span class="kbd" id="hint"></span>
      </div>
      <div style="display:flex; gap:10px; align-items:center">
        <button class="quiet hidden" id="secondaryBtn" onclick="secondaryAction()"> </button>
        <button class="primary" id="nextBtn" onclick="next()">Next</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="hidden" style="position:fixed; left:50%; transform:translateX(-50%); bottom:86px; background:#fff; border:2px solid var(--line); padding:8px 10px; border-radius:999px; box-shadow:none; color:var(--text); font-size:13px; z-index:70; font-weight:900;"></div>

  <!-- Drawer -->
  <div id="drawerOverlay" class="drawerOverlay" onclick="closeDrawer(event)">
    <div class="drawer card" onclick="event.stopPropagation()">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:10px">
        <div style="font-weight:900">Task details</div>
        <button class="quiet" onclick="hideDrawer()">Close</button>
      </div>
      <div class="divider"></div>
      <div id="drawerContent"></div>
    </div>
  </div>

<script>
  const steps = [
    { id:"method", title:"Method" },
    { id:"document", title:"Document" },
    { id:"analyze", title:"Analyze" },
    { id:"scope", title:"Regulatory scope" },
    { id:"regTasks", title:"Regulatory tasks" },
    { id:"orgTasks", title:"Organizational tasks" },
    { id:"summary", title:"Summary" },
  ];

  let state = {
    screen: "wizard",
    stepIndex: 0,
    method: "ai",
    fileName: "Carrier A contract.pdf",
    scopeRows: [
      {on:true, st:"CA", prod:"Life", licName:"Life Agent", licCode:"CA-LIFE", loaName:"Life", loaCode:"L"},
      {on:true, st:"CA", prod:"Annuity", licName:"Life Agent", licCode:"CA-LIFE", loaName:"Variable Annuity", loaCode:"VA"},
      {on:true, st:"TX", prod:"Life", licName:"General Lines Life, Accident, Health", licCode:"TX-GL", loaName:"Life", loaCode:"L"},
      {on:true, st:"FL", prod:"Annuity", licName:"Life", licCode:"FL-L", loaName:"Annuities", loaCode:"A"},
      {on:true, st:"AZ", prod:"Life", licName:"Life", licCode:"AZ-L", loaName:"Life", loaCode:"L"},
      {on:true, st:"CO", prod:"Life", licName:"Life", licCode:"CO-L", loaName:"Life", loaCode:"L"},
    ],
    regTasks: [
      { name:"Verify active resident license", type:"Approval", desc:"Confirm producer holds an active, eligible resident license for the Policy Set scope.", who:"Operations Manager", approver:"Compliance (optional)" },
      { name:"Confirm LOA eligibility", type:"Attest", desc:"Producer attests they are authorized for relevant lines of authority.", who:"Producer", approver:"Operations Manager" },
      { name:"Background check requirement", type:"Upload", desc:"Collect evidence or confirmation that screening requirements are met (if applicable).", who:"Producer", approver:"Operations Manager" },
      { name:"State-specific appointment filing", type:"Data", desc:"Ensure appointment filing workflow triggers for in-scope states where required.", who:"System", approver:"Operations Manager" },
    ],
    orgTasks: [
      { name:"Carrier training: Product overview", type:"Read/Ack", desc:"Producer reviews carrier-required product overview training content.", who:"Producer", approver:"None" },
      { name:"W-9 / tax form on file", type:"Upload", desc:"Collect required tax documentation as part of carrier contracting.", who:"Producer", approver:"Operations Manager" },
      { name:"E&O insurance verification", type:"Upload", desc:"Confirm producer has required Errors & Omissions coverage.", who:"Producer", approver:"Operations Manager" },
    ],
    selectedRegTask: 0,
    selectedOrgTask: 0,
  };

  function $(id){ return document.getElementById(id); }
  const __params = new URLSearchParams(window.location.search);
  const __home = __params.get("home") || "./index.html";

  function goHome(){
    window.location.href = __home;
  }


  function go(screen){
    state.screen = screen;
    document.querySelectorAll(".screen").forEach(s => s.classList.add("hidden"));
    const target = $(screen);
    if(!target){ return; }
    target.classList.remove("hidden");
    if(screen === "wizard"){
      renderStepper();
      renderStep();
      $("sticky").classList.remove("hidden");
    } else {
      $("sticky").classList.add("hidden");
    }
    hideDrawer();
  }

  function startPolicySet(){
    state.stepIndex = 0;
    go("wizard");
  }

  function renderStepper(){
    const el = $("stepper");
    el.innerHTML = "";
    steps.forEach((s, i) => {
      const stepEl = document.createElement("div");
      stepEl.className = "step" + (i === state.stepIndex ? " active" : "") + (i < state.stepIndex ? " done" : "");
      stepEl.onclick = () => jump(i);
      stepEl.innerHTML = `
        <div class="dot">${i < state.stepIndex ? "✓" : (i+1)}</div>
        <div style="font-weight:900">${s.title}</div>`;
      el.appendChild(stepEl);
    });
  }

  function jump(i){
    if(i <= state.stepIndex){
      state.stepIndex = i;
      renderStepper();
      renderStep();
    } else {
      toast("Complete the step using the primary CTA.");
    }
  }

  function back(){
    if(state.stepIndex === 0){ goHome(); return; }
    state.stepIndex -= 1;
    renderStepper();
    renderStep();
  }

  function next(){
    const id = steps[state.stepIndex].id;
    if(id === "analyze"){ return; }
    if(state.stepIndex < steps.length - 1){
      state.stepIndex += 1;
      renderStepper();
      renderStep();
    }
  }

  function secondaryAction(){
    const id = steps[state.stepIndex].id;
    if(id === "document"){
      toast("In the full product this would switch to manual scope entry.");
    } else if(id === "scope"){
      toast("CSV exported (prototype).");
    } else if(id === "summary"){
      toast("This would open the Policy Sets list view.");
    }
  }

  function setSticky({nextLabel="Next", secondaryLabel="", hint=""}){
    $("nextBtn").textContent = nextLabel;
    $("hint").textContent = hint || "";
    const s = $("secondaryBtn");
    if(!secondaryLabel){
      s.classList.add("hidden");
    } else {
      s.classList.remove("hidden");
      s.textContent = secondaryLabel;
    }
  }

  function renderStep(){
    const id = steps[state.stepIndex].id;
    const c = $("stepContent");

    $("backBtn").textContent = (state.stepIndex === 0) ? "Back to Prototype Hub" : "Back";
    $("nextBtn").onclick = next;

    if(id === "method"){
      c.innerHTML = `
        <h2>How do you want to create this Policy Set?</h2>
        <p>Choose a method. You can review everything before confirming.</p>

        <div class="section grid2">
          <div class="radio-card ${state.method==="ai" ? "selected":""}" onclick="chooseMethod('ai')">
            <div class="radio"><div class="inner"></div></div>
            <div>
              <h3>Use AI (recommended)</h3>
              <p>Upload a carrier contract or program guide. We’ll draft scope + tasks for review.</p>
            </div>
          </div>
          <div class="radio-card ${state.method==="manual" ? "selected":""}" onclick="chooseMethod('manual')">
            <div class="radio"><div class="inner"></div></div>
            <div>
              <h3>Manual</h3>
              <p>Build scope + requirements from scratch.</p>
            </div>
          </div>
        </div>
      `;
      setSticky({nextLabel:"Continue", hint:"One primary choice"});
    }

    if(id === "document"){
      c.innerHTML = `
        <h2>Upload source document</h2>
        <p>Drop a file to generate an initial Policy Set draft.</p>

        <div class="section grid2">
          <div class="panel">
            <div class="dropzone">
              <div class="filetile">
                <div class="fileicon">PDF</div>
                <div class="filemeta">
                  <div class="name">${escapeHtml(state.fileName)}</div>
                  <div class="hint">Already added • Replace or remove</div>
                </div>
              </div>
              <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end">
                <button class="quiet" onclick="toast('Replace file (prototype)')">Replace</button>
                <button class="quiet" onclick="toast('Remove file (prototype)')">Remove</button>
              </div>
            </div>
            <div class="subtitle" style="margin-top:10px">Supported: PDF, DOCX (max 25MB)</div>
          </div>

          <div class="panel">
            <div style="font-weight:900; margin-bottom:8px">What we’ll extract</div>
            <div class="tags">
              <span class="tag">States</span>
              <span class="tag">Products</span>
              <span class="tag">Licenses / LOAs</span>
              <span class="tag">Carrier requirements</span>
            </div>
            <div class="divider"></div>
            <button class="linkbtn" onclick="toast('Would switch to manual entry')">Skip and enter scope manually</button>
          </div>
        </div>
      `;
      setSticky({nextLabel:"Next: Analyze", secondaryLabel:"Skip (manual)", hint:"Upload → analyze → review"});
    }

    if(id === "analyze"){
      c.innerHTML = `
        <h2>Analyzing your document</h2>
        <p>We’re extracting regulatory scope and drafting tasks.</p>

        <div class="section panel">
          <div style="display:flex; flex-direction:column; gap:10px; font-weight:900">
            <div>1) Extracting regulatory scope…</div>
            <div>2) Detecting product types…</div>
            <div>3) Drafting tasks…</div>
          </div>
          <div class="divider"></div>
          <div class="subtitle">You’ll be able to review everything before confirming.</div>
        </div>
      `;
      setSticky({nextLabel:"Working…", hint:"Auto-advances"});
      setTimeout(() => {
        if(steps[state.stepIndex].id === "analyze"){
          state.stepIndex += 1;
          renderStepper();
          renderStep();
        }
      }, 700);
    }

    if(id === "scope"){
      const states = ["CA","TX","FL","AZ","CO","NV"];
      const products = ["Life","Annuity"];
      c.innerHTML = `
        <h2>Confirm regulatory scope</h2>
        <p>Review what we extracted. Unchecked rows won’t be included in this Policy Set.</p>

        <div class="section banner">
          <div>
            <div class="line">We found regulatory scope for ${states.length} states <span>(${states.join(", ")})</span></div>
            <div class="line">Products allowed <span>(${products.join(", ")})</span></div>
          </div>
          <div>
            <button class="quiet" onclick="toast('Expanded lists (prototype)')">Expand</button>
          </div>
        </div>

        <div class="toolbar">
          <input class="input" placeholder="Search to add scope…" oninput="toast('Add row search (prototype)')" />
          <div style="display:flex; gap:10px; flex-wrap:wrap">
            <button class="quiet" onclick="selectAll(true)">Select all</button>
            <button class="quiet" onclick="selectAll(false)">Select none</button>
          </div>
        </div>

        <div class="tablewrap">
          <table>
            <thead>
              <tr>
                <th style="width:42px"><input type="checkbox" class="check" onclick="toggleHeader(this)" /></th>
                <th>State</th><th>Product Type</th><th>License Name</th><th>License Code</th><th>LOA Name</th><th>LOA Code</th>
              </tr>
            </thead>
            <tbody>
              ${state.scopeRows.map((r, idx) => `
                <tr>
                  <td><input type="checkbox" class="check" ${r.on ? "checked":""} onchange="toggleRow(${idx}, this.checked)" /></td>
                  <td>${r.st}</td><td>${r.prod}</td><td>${escapeHtml(r.licName)}</td><td>${r.licCode}</td><td>${escapeHtml(r.loaName)}</td><td>${r.loaCode}</td>
                </tr>
              `).join("")}
            </tbody>
          </table>
        </div>
      `;
      setSticky({nextLabel:"Confirm regulatory scope", secondaryLabel:"Download CSV", hint:"Prune + add rows"});
    }

    if(id === "regTasks"){
      c.innerHTML = `
        <h2>Regulatory requirements</h2>
        <p>Scan the list. Open details only when you need to modify something.</p>

        <div class="listonly">
          <div class="list">
            <div class="listhead">
              <div class="title2">Tasks</div>
              <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap">
                <input class="input" style="width:260px" placeholder="Search tasks…" oninput="toast('Task search (prototype)')" />
                <button class="quiet" onclick="addTask('reg')">+ New task</button>
              </div>
            </div>

            ${state.regTasks.map((t, i) => `
              <div class="item ${i===state.selectedRegTask ? "active":""}" onclick="openTask('reg', ${i})">
                <div class="leftmeta">
                  <div class="row1">
                    <div class="name">${escapeHtml(t.name)}</div>
                    <span class="badge">${t.type}</span>
                  </div>
                  <div class="hintline">Click to view details</div>
                </div>
                <div class="rightmeta">
                  <button class="secondaryAction" onclick="event.stopPropagation(); toast('Quick edit (prototype)')">Edit</button>
                  <span class="chev">&gt;</span>
                </div>
              </div>
            `).join("")}
          </div>
        </div>
      `;
      setSticky({nextLabel:"Confirm regulatory tasks", hint:"List-first scanning"});
    }

    if(id === "orgTasks"){
      c.innerHTML = `
        <h2>Organizational requirements</h2>
        <p>Scan carrier/agency requirements. Open details only when necessary.</p>

        <div class="listonly">
          <div class="list">
            <div class="listhead">
              <div class="title2">Tasks</div>
              <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap">
                <input class="input" style="width:260px" placeholder="Search tasks…" oninput="toast('Task search (prototype)')" />
                <button class="quiet" onclick="addTask('org')">+ New task</button>
              </div>
            </div>

            ${state.orgTasks.map((t, i) => `
              <div class="item ${i===state.selectedOrgTask ? "active":""}" onclick="openTask('org', ${i})">
                <div class="leftmeta">
                  <div class="row1">
                    <div class="name">${escapeHtml(t.name)}</div>
                    <span class="badge">${t.type}</span>
                  </div>
                  <div class="hintline">Click to view details</div>
                </div>
                <div class="rightmeta">
                  <button class="secondaryAction" onclick="event.stopPropagation(); toast('Quick edit (prototype)')">Edit</button>
                  <span class="chev">&gt;</span>
                </div>
              </div>
            `).join("")}
          </div>
        </div>
      `;
      setSticky({nextLabel:"Confirm organizational tasks", hint:"List-first scanning"});
    }

    if(id === "summary"){
      c.innerHTML = `
        <h2>Policy Set created</h2>
        <p>Review what this Policy Set contains. You can modify any section.</p>

        <div class="section panel">
          <div style="display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap">
            <div style="display:flex; flex-direction:column; gap:6px">
              <div style="font-weight:900">Policy Set name</div>
              <div class="subtitle" style="margin:0">Carrier A – Life/Annuity – Southwest</div>
            </div>
            <button class="quiet" onclick="toast('Rename (prototype)')">Rename</button>
          </div>
        </div>

        <div class="cards1">
          <div class="card summarycard">
            <h3>Regulatory scope</h3>
            <p><strong>74 regulatory codes</strong> across <strong>6 states</strong> allowing producers to sell <strong>2 product types</strong>.</p>
            <div class="divider"></div>
            <button class="linkbtn" onclick="jumpTo('scope')">Review / Modify</button>
          </div>
          <div class="card summarycard">
            <h3>Regulatory requirements</h3>
            <p>All regulatory tasks within the scope of your policy set.</p>
            <div class="divider"></div>
            <button class="linkbtn" onclick="jumpTo('regTasks')">Review / Modify</button>
          </div>
          <div class="card summarycard">
            <h3>Organizational requirements</h3>
            <p>Non-regulatory requirements to satisfy appointing and ready-to-sell.</p>
            <div class="divider"></div>
            <button class="linkbtn" onclick="jumpTo('orgTasks')">Review / Modify</button>
          </div>
        </div>

        <div class="section panel">
          <div style="display:flex; gap:10px; flex-wrap:wrap">
            <button class="primary" onclick="toast('Would navigate to firm mapping flow')">Map to a firm</button>
            <button class="quiet" onclick="toast('Would open Policy Sets list view')">View all Policy Sets</button>
            <button class="quiet" onclick="startPolicySet()">Create another Policy Set</button>
          </div>
        </div>
      `;
      setSticky({nextLabel:"Back to Prototype Hub", secondaryLabel:"Policy Sets list", hint:"Create → map → operate"});
      $("nextBtn").onclick = () => goHome();
      return;
    }
  }

  function chooseMethod(m){
    state.method = m;
    renderStep();
  }

  function toggleRow(idx, checked){
    state.scopeRows[idx].on = checked;
  }

  function toggleHeader(cb){
    const checked = cb.checked;
    state.scopeRows.forEach(r => r.on = checked);
    renderStep();
  }

  function selectAll(on){
    state.scopeRows.forEach(r => r.on = on);
    renderStep();
  }

  function addTask(kind){
    toast("Add task (prototype) — would open drawer");
  }

  function openTask(kind, idx){
    if(kind === "reg") state.selectedRegTask = idx;
    else state.selectedOrgTask = idx;
    showDrawer(kind);
    // keep list visible / primary focus; drawer is secondary
    renderStep();
  }

  function showDrawer(kind){
    const t = (kind === "reg") ? state.regTasks[state.selectedRegTask] : state.orgTasks[state.selectedOrgTask];
    $("drawerContent").innerHTML = renderTaskDetail(t);
    $("drawerOverlay").style.display = "flex";
  }

  function hideDrawer(){
    $("drawerOverlay").style.display = "none";
  }

  function closeDrawer(e){
    // click outside drawer closes
    hideDrawer();
  }

  function renderTaskDetail(t){
    return `
      <h3>${escapeHtml(t.name)}</h3>
      <p style="margin:0; color:#555; font-weight:700; line-height:1.35">${escapeHtml(t.desc)}</p>
      <div class="kv">
        <div class="k">Task type</div><div class="v">${escapeHtml(t.type)}</div>
        <div class="k">Completed by</div><div class="v">${escapeHtml(t.who)}</div>
        <div class="k">Approver</div><div class="v">${escapeHtml(t.approver)}</div>
      </div>
      <div class="divider"></div>
      <div style="display:flex; gap:10px; flex-wrap:wrap">
        <button class="primary" onclick="toast('Edit task (prototype)')">Edit task</button>
        <button class="quiet" onclick="toast('Delete task (prototype)')">Delete</button>
      </div>
    `;
  }

  function jumpTo(stepId){
    const idx = steps.findIndex(s => s.id === stepId);
    if(idx >= 0){
      state.stepIndex = idx;
      renderStepper();
      renderStep();
      window.scrollTo({top:0, behavior:"smooth"});
    }
  }

  function toast(msg){
    const el = $("toast");
    el.textContent = msg;
    el.classList.remove("hidden");
    clearTimeout(window.__toastTimer);
    window.__toastTimer = setTimeout(() => el.classList.add("hidden"), 1400);
  }

  function escapeHtml(str){
    return String(str)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  // init
  go("wizard");
</script>
</body>
</html>
